<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Bihar Travel Map | TRAVALLY</title>
    <link rel="icon" href="https://vicky-tec.github.io/TRAVALLY/TRAVALLY.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Protest+Revolution&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css">
    <style>
        :root {
            --primary: #06B6D4;
            --secondary: #9333EA;
            --accent: #EC4899;
            --dark: #1E293B;
            --light: #F8FAFC;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --text-color: #333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(128, 0, 255, 0.1), rgba(0, 91, 144, 0.1));
            color: var(--text-color);
            line-height: 1.6;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 5%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .nav-links {
            list-style: none;
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 0.5rem 0;
            position: relative;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .logo {
            height: 50px;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .map-container {
            display: flex;
            flex-direction: column;
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .map-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 0 1rem;
        }

        .map-header h1 {
            font-family: "Protest Revolution", sans-serif;
            color: var(--primary);
            font-size: 2.8rem;
            margin-bottom: 1rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
        }

        .map-header p {
            color: var(--dark);
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.1rem;
        }

        .map-content {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .map-wrapper {
            flex: 2;
            min-width: 300px;
        }

        #bihar-map {
            height: 700px;
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        .map-sidebar {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .map-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .map-btn {
            padding: 0.7rem 1.2rem;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .map-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .map-btn.active {
            background: var(--dark);
            transform: translateY(-1px);
        }

        .search-box {
            display: flex;
            margin-bottom: 1rem;
        }

        .search-box input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px 0 0 8px;
            font-size: 1rem;
            outline: none;
        }

        .search-box button {
            padding: 0 1rem;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .info-panel {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            height: 100%;
            overflow-y: auto;
        }

        .info-panel h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.3rem;
        }

        .location-list {
            list-style: none;
        }

        .location-item {
            padding: 0.8rem 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .location-item:last-child {
            border-bottom: none;
        }

        .location-item:hover {
            background-color: #f8f9fa;
            padding-left: 5px;
        }

        .location-item h4 {
            color: var(--dark);
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .location-item p {
            color: var(--text-color);
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .weather-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }

        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .weather-city {
            font-weight: 600;
            color: var(--dark);
        }

        .weather-temp {
            font-size: 2rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .weather-details {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .weather-detail {
            flex: 1;
            min-width: 120px;
            background: #f8f9fa;
            padding: 0.8rem;
            border-radius: 8px;
            text-align: center;
        }

        .weather-detail i {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .weather-detail p {
            margin: 0;
            font-size: 0.9rem;
        }

        .weather-detail .value {
            font-weight: 600;
            color: var(--dark);
        }

        footer {
            background-color: var(--dark);
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .social-links a {
            color: white;
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }

        .social-links a:hover {
            color: var(--primary);
        }

        @media (max-width: 1024px) {
            .map-content {
                flex-direction: column;
            }

            #bihar-map {
                height: 500px;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                padding: 1rem;
            }

            .nav-links {
                margin-top: 1rem;
                gap: 1rem;
            }

            .map-header h1 {
                font-size: 2.2rem;
            }

            #bihar-map {
                height: 400px;
            }
        }

        /* Custom map elements */
        .custom-marker {
            background: var(--gradient);
            width: 28px;
            height: 28px;
            border-radius: 50% 50% 50% 0;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            transform: rotate(-45deg);
        }

        .custom-marker i {
            transform: rotate(45deg);
        }

        .map-legend {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            line-height: 1.6;
            font-size: 0.9rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 0.8rem;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
        }

        /* Routing controls */
        .leaflet-routing-container {
            background: white;
            border-radius: 8px;
            padding: 0.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 300px;
            max-width: 90%; /* Added for responsiveness */
        }

        .leaflet-routing-alt {
            max-height: 200px;
            overflow-y: auto;
        }

        /* Custom popup styles */
        .leaflet-popup-content {
            min-width: 200px;
        }

        .popup-header {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .popup-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .popup-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.8rem;
        }

        .popup-btn {
            flex: 1;
            padding: 0.3rem;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            text-align: center;
        }

        /* Animation */
        @keyframes pulse {
            0% { transform: scale(1) rotate(-45deg); }
            50% { transform: scale(1.1) rotate(-45deg); }
            100% { transform: scale(1) rotate(-45deg); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <a href="index.html">
                <img src="https://vicky-tec.github.io/TRAVALLY/TRAVALLY.png" alt="TRAVALLY logo" class="logo">
            </a>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="map.html" class="active">Bihar Map</a></li>
            <li><a href="bot.html">YuktiBot</a></li>
            <li><a href="About us.html">About</a></li>
        </ul>
    </nav>

    <div class="map-container">
        <div class="map-header">
            <h1>Explore Bihar</h1>
            <p>Discover the rich cultural heritage, spiritual destinations, and hidden gems of Bihar with our interactive travel companion. Get real-time information about tourist spots, transportation, weather, and local events.</p>
        </div>

        <div class="map-content">
            <div class="map-wrapper">
                <div class="map-controls">
                    <button class="map-btn active" id="btn-tourist" onclick="showTouristSpots()">
                        <i class="fas fa-landmark"></i> Tourist Spots
                    </button>
                    <button class="map-btn" id="btn-transport" onclick="showTransportation()">
                        <i class="fas fa-bus"></i> Transportation
                    </button>
                    <button class="map-btn" id="btn-hotels" onclick="showHotels()">
                        <i class="fas fa-hotel"></i> Hotels
                    </button>
                    <button class="map-btn" id="btn-events" onclick="showEvents()">
                        <i class="fas fa-calendar-alt"></i> Events
                    </button>
                    <button class="map-btn" id="btn-all" onclick="showAll()">
                        <i class="fas fa-layer-group"></i> Show All
                    </button>
                    <button class="map-btn" id="btn-route" onclick="toggleRoute()">
                        <i class="fas fa-route"></i> Route
                    </button>
                </div>

                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search locations in Bihar...">
                    <button onclick="searchLocation()"><i class="fas fa-search"></i></button>
                </div>

                <div id="bihar-map"></div>
            </div>

            <div class="map-sidebar">
                <div class="weather-card">
                    <h3><i class="fas fa-cloud-sun"></i> Current Weather</h3>
                    <div id="weather-info">
                        Loading weather data...
                    </div>
                </div>

                <div class="info-panel">
                    <h3><i class="fas fa-info-circle"></i> Popular Destinations</h3>
                    <ul class="location-list" id="location-list">
                        </ul>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="social-links">
            <a href="https://www.facebook.com"><i class="fab fa-facebook"></i></a>
            <a href="https://www.twitter.com"><i class="fab fa-twitter"></i></a>
            <a href="https://www.instagram.com"><i class="fab fa-instagram"></i></a>
            <a href="https://www.linkedin.com"><i class="fab fa-linkedin"></i></a>
        </div>
        <p>&copy; 2025 TRAVALLY | Designed with devotion ✨</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script>
        // Initialize the map centered on Bihar
        const map = L.map('bihar-map').setView([25.0961, 85.3131], 7);

        // Add OpenStreetMap tiles with custom style
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18,
        }).addTo(map);

        // Add more detailed base map option
        const transportMap = L.tileLayer('https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=6170aad10dfd42a38d4d8c709a536f38', {
             attribution: '&copy; <a href="https://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
             maxZoom: 22,
        });

        // Add satellite imagery option
        const satelliteMap = L.tileLayer('https://server.arcgisonoline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
            maxZoom: 22,
        });

        // Add base layer control
        const baseMaps = {
            "Standard": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
            "Transport": transportMap,
            "Satellite": satelliteMap
        };

        // More accurate Bihar boundary coordinates (simplified)
        const biharBoundary = L.geoJSON({
            "type": "Feature",
            "properties": { "name": "Bihar" },
            "geometry": {
                "type": "Polygon",
                "coordinates": [[
                    [83.19, 27.31], [88.19, 27.31], [88.19, 24.20],
                    [83.19, 24.20], [83.19, 27.31]
                ]]
            }
        }, {
            color: '#06B6D4',
            weight: 2,
            fillOpacity: 0.05,
            fillColor: '#06B6D4'
        }).addTo(map);

        // Add hover effect to boundary
        biharBoundary.on('mouseover', function() {
            this.setStyle({ fillOpacity: 0.2 });
        });

        biharBoundary.on('mouseout', function() {
            this.setStyle({ fillOpacity: 0.05 });
        });

        // Bihar districts data (sample) - Used for circle markers
        const districts = [
            { name: "Patna", coords: [25.5941, 85.1376], population: "5.8 million" },
            { name: "Gaya", coords: [24.7955, 85.0000], population: "4.3 million" },
            { name: "Bhagalpur", coords: [25.2445, 86.9718], population: "3.0 million" },
            { name: "Muzaffarpur", coords: [26.1209, 85.3647], population: "4.8 million" },
            { name: "Darbhanga", coords: [26.1529, 85.8972], population: "3.9 million" }
        ];

        // Add districts to map as circle markers
        districts.forEach(district => {
            L.circleMarker(district.coords, {
                radius: 8,
                fillColor: "#9333EA",
                color: "#fff",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            }).bindPopup(`<b>${district.name}</b><br>Population: ${district.population}`).addTo(map);
        });

        // Enhanced locations data with images and more details
        const locations = [
            {
                id: 1,
                name: "Mahabodhi Temple",
                coords: [24.6961, 84.9913],
                type: "spiritual",
                category: "Buddhist",
                description: "UNESCO World Heritage Site where Buddha attained enlightenment",
                icon: "temple",
                image: "https://vicky-tec.github.io/TRAVALLY/mahabodhi_temple.jpg",
                rating: "4.8",
                hours: "5AM-9PM",
                fee: "Free"
            },
            {
                id: 2,
                name: "Nalanda University Ruins",
                coords: [25.1368, 85.4439],
                type: "historical",
                category: "Archaeological",
                description: "Ancient center of learning dating back to 5th century CE",
                icon: "landmark",
                image: "https://vicky-tec.github.io/TRAVALLY/nalanda_ruins.jpg",
                rating: "4.6",
                hours: "9AM-5PM",
                fee: "₹40 for Indians, ₹600 for foreigners"
            },
            {
                id: 3,
                name: "Patna Museum",
                coords: [25.6114, 85.1456],
                type: "historical",
                category: "Museum",
                description: "State museum showcasing Bihar's rich history and artifacts",
                icon: "museum",
                image: "https://vicky-tec.github.io. TRAVALLY/patna_museum.jpg",
                rating: "4.2",
                hours: "10:30AM-4:30PM (Closed Mondays)",
                fee: "₹100 for Indians, ₹250 for foreigners"
            },
            {
                id: 4,
                name: "Vishwa Shanti Stupa, Rajgir",
                coords: [25.0031, 85.4242],
                type: "spiritual",
                category: "Buddhist",
                description: "Peace pagoda in Rajgir with panoramic views",
                icon: "peace",
                image: "https://vicky-tec.github.io/TRAVALLY/vishwa_shanti_stupa.jpg",
                rating: "4.5",
                hours: "Sunrise to Sunset",
                fee: "Free (Cable car ₹150)"
            },
            {
                id: 5,
                name: "Gaya Junction Railway Station",
                coords: [24.8147, 85.0036],
                type: "transport",
                category: "Railway",
                description: "Major railway station connecting to all parts of India",
                icon: "train",
                image: "https://vicky-tec.github.io/TRAVALLY/gaya_junction.jpg",
                rating: "3.8",
                hours: "24/7",
                fee: "N/A"
            },
            {
                id: 6,
                name: "Patna Airport",
                coords: [25.5913, 85.0879],
                type: "transport",
                category: "Airport",
                description: "Jay Prakash Narayan International Airport",
                icon: "plane",
                image: "https://vicky-tec.github.io/TRAVALLY/patna_airport.jpg",
                rating: "4.0",
                hours: "24/7",
                fee: "N/A"
            },
            {
                id: 7,
                name: "Sonepur Mela Ground",
                coords: [25.7000, 85.1833],
                type: "event",
                category: "Fair",
                description: "Asia's largest cattle fair (held annually in Nov-Dec)",
                icon: "calendar",
                image: "https://vicky-tec.github.io/TRAVALLY/sonepur_mela.jpg",
                rating: "4.3",
                hours: "During event dates",
                fee: "Free entry"
            },
            {
                id: 8,
                name: "Jal Mandir, Pawapuri",
                coords: [25.0884, 85.5386],
                type: "spiritual",
                category: "Jain",
                description: "Important Jain pilgrimage site in a lotus-filled lake",
                icon: "temple",
                image: "https://vicky-tec.github.io/TRAVALLY/jal_mandir_pawapuri.jpg",
                rating: "4.4",
                hours: "6AM-7PM",
                fee: "Free"
            },
            {
                id: 9,
                name: "Vikramshila Ruins",
                coords: [25.2583, 87.3076],
                type: "historical",
                category: "Archaeological",
                description: "Ancient Buddhist university ruins",
                icon: "landmark",
                image: "https://vicky-tec.github.io/TRAVALLY/vikramshila_ruins.jpg",
                rating: "4.1",
                hours: "9AM-5PM",
                fee: "₹25 for Indians, ₹300 for foreigners"
            },
             {
                id: 10,
                name: "Takht Sri Patna Sahib",
                coords: [25.5948, 85.1732],
                type: "spiritual",
                category: "Sikh",
                description: "Birthplace of Guru Gobind Singh, important Sikh pilgrimage site",
                icon: "temple",
                image: "https://vicky-tec.github.io/TRAVALLY/takht_sri_patna_sahib.jpg",
                rating: "4.7",
                hours: "4AM-9PM",
                fee: "Free"
            },
            {
                id: 11,
                name: "Golghar, Patna",
                coords: [25.614, 85.1636],
                type: "historical",
                category: "Monument",
                description: "Large granary built in 1786, offers panoramic city views",
                icon: "building",
                image: "https://vicky-tec.github.io/TRAVALLY/golghar_patna.jpg",
                rating: "4.0",
                hours: "10AM-5PM (Closed Mondays)",
                fee: "₹10 entry"
            }
            // Add more locations here
        ];

        // Dummy hotel locations (replace with real data if available)
        const hotels = [
             {
                id: 101,
                name: "Hotel Maurya, Patna",
                coords: [25.609, 85.153],
                type: "hotel",
                category: "Luxury",
                description: "Prominent hotel in Patna",
                icon: "hotel",
                image: "https://vicky-tec.github.io/TRAVALLY/hotel_maurya.jpg",
                rating: "4.3",
                hours: "24/7",
                fee: "N/A"
            },
             {
                id: 102,
                name: "Lemon Tree Premier, Patna",
                coords: [25.605, 85.148],
                type: "hotel",
                category: "Mid-range",
                description: "Modern hotel in Patna",
                icon: "hotel",
                image: "https://vicky-tec.github.io/TRAVALLY/lemon_tree_patna.jpg",
                rating: "4.2",
                hours: "24/7",
                fee: "N/A"
            }
            // Add more dummy hotels
        ];

         // Combine locations and hotels for the map and list
        const allLocations = locations.concat(hotels);


        // Create layer groups for different types of locations
        const spiritualLayer = L.layerGroup();
        const historicalLayer = L.layerGroup();
        const transportLayer = L.layerGroup();
        const eventLayer = L.layerGroup();
        const hotelLayer = L.layerGroup();
        const allMarkers = [];

        // Add markers to the map with custom icons
        allLocations.forEach(location => {
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<i class="fas fa-${location.icon}"></i>`,
                iconSize: [28, 28]
            });

            const marker = L.marker(location.coords, {
                icon: icon,
                riseOnHover: true
            });

            // Custom popup content
            const popupContent = `
                <div>
                    <div class="popup-header">
                        <i class="fas fa-${location.icon}"></i>
                        ${location.name}
                    </div>
                    <img src="${location.image}" class="popup-image" alt="${location.name}">
                    <p>${location.description}</p>
                    ${location.rating ? `<p><i class="fas fa-star"></i> Rating: ${location.rating}/5</p>` : ''}
                    ${location.hours ? `<p><i class="fas fa-clock"></i> Hours: ${location.hours}</p>` : ''}
                    ${location.fee && location.fee !== 'N/A' ? `<p><i class="fas fa-ticket-alt"></i> Entry: ${location.fee}</p>` : ''}
                    <div class="popup-actions">
                        <button class="popup-btn" onclick="startNavigation(${location.coords[0]}, ${location.coords[1]})">
                            <i class="fas fa-directions"></i> Directions
                        </button>
                         <button class="popup-btn" onclick="zoomToLocation(${location.coords[0]}, ${location.coords[1]}, 15)">
                            <i class="fas fa-search-plus"></i> Zoom In
                        </button>
                    </div>
                </div>
            `;

            marker.bindPopup(popupContent, { maxWidth: 300 });
            marker.locationId = location.id; // Store location id with marker
            allMarkers.push(marker);

            // Add to appropriate layer
            if (location.type === "spiritual") {
                marker.addTo(spiritualLayer);
            } else if (location.type === "historical") {
                marker.addTo(historicalLayer);
            } else if (location.type === "transport") {
                marker.addTo(transportLayer);
            } else if (location.type === "event") {
                marker.addTo(eventLayer);
            } else if (location.type === "hotel") {
                marker.addTo(hotelLayer);
            }
        });

         // Add overlay maps control
        const overlayMaps = {
            "Spiritual Sites": spiritualLayer,
            "Historical Places": historicalLayer,
            "Transport Hubs": transportLayer,
            "Events": eventLayer,
            "Hotels": hotelLayer
        };

        L.control.layers(baseMaps, overlayMaps, {collapsed: false}).addTo(map);


        // Add legend
        const legend = L.control({position: 'bottomright'});

        legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'map-legend');
            div.innerHTML = `
                <h4>Map Legend</h4>
                <div class="legend-item"><span class="legend-color" style="background: #06B6D4"><i class="fas fa-temple"></i></span> Spiritual</div>
                <div class="legend-item"><span class="legend-color" style="background: #9333EA"><i class="fas fa-landmark"></i></span> Historical</div>
                <div class="legend-item"><span class="legend-color" style="background: #EC4899"><i class="fas fa-bus"></i></span> Transport</div>
                <div class="legend-item"><span class="legend-color" style="background: #F59E0B"><i class="fas fa-calendar-alt"></i></span> Events</div>
                <div class="legend-item"><span class="legend-color" style="background: #00CC66"><i class="fas fa-hotel"></i></span> Hotels</div>
            `; // Added icons to legend
            return div;
        };

        legend.addTo(map);

        // Routing control
        let routingControl = null;

        function toggleRoute() {
            const routeButton = document.getElementById('btn-route');
            if (routingControl) {
                map.removeControl(routingControl);
                routingControl = null;
                routeButton.classList.remove('active');
                routeButton.innerHTML = '<i class="fas fa-route"></i> Route';
            } else {
                routingControl = L.Routing.control({
                    waypoints: [],
                    routeWhileDragging: true,
                    showAlternatives: true,
                    fitSelectedRoutes: true,
                     lineOptions: {
                        styles: [
                            {color: 'black', opacity: 0.15, weight: 9},
                            {color: 'white', opacity: 0.8, weight: 6},
                            {color: '#EC4899', opacity: 1, weight: 4} // Main route color
                        ]
                    },
                     altLineOptions: {
                         styles: [
                            {color: '#06B6D4', opacity: 0.5, weight: 4} // Alternative route color
                        ]
                    },
                    createMarker: function(i, wp, nWps) {
                        return L.marker(wp.latLng, {
                            icon: L.divIcon({
                                className: `custom-marker ${i === 0 ? 'pulse' : ''}`, // Pulse on start marker
                                html: `<i class="fas fa-${i === 0 ? 'map-marker-alt' : 'flag'}"></i>`,
                                iconSize: [28, 28]
                            })
                        });
                    }
                }).addTo(map);
                routeButton.classList.add('active');
                 routeButton.innerHTML = '<i class="fas fa-times"></i> Cancel Route';
            }
        }

        function startNavigation(lat, lng) {
            if (!routingControl) {
                 toggleRoute(); // Activate routing if not already active
            }

            // Get user's current location (using browser geolocation)
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const userLocation = [position.coords.latitude, position.coords.longitude];
                     routingControl.setWaypoints([
                        L.latLng(userLocation[0], userLocation[1]),
                        L.latLng(lat, lng)
                    ]);
                }, () => {
                    // Handle geolocation error or denial
                    alert("Could not retrieve your location. Please enable geolocation.");
                     // Optionally set a default start point if geolocation fails
                     routingControl.setWaypoints([
                        L.latLng(25.6099, 85.1374), // Default to a central point like Patna
                        L.latLng(lat, lng)
                    ]);
                });
            } else {
                 alert("Geolocation is not supported by your browser.");
                 // Optionally set a default start point if geolocation is not supported
                 routingControl.setWaypoints([
                    L.latLng(25.6099, 85.1374), // Default to a central point like Patna
                    L.latLng(lat, lng)
                ]);
            }
        }

        // Function to update the location list in the sidebar
        function updateLocationList(filterType) {
            const locationList = document.getElementById('location-list');
            locationList.innerHTML = ''; // Clear current list

            const filteredLocations = allLocations.filter(location =>
                filterType === 'all' || location.type === filterType
            );

            filteredLocations.forEach(location => {
                const listItem = document.createElement('li');
                listItem.classList.add('location-item');
                listItem.innerHTML = `
                    <h4><i class="fas fa-${location.icon}"></i> ${location.name}</h4>
                    <p>${location.description}</p>
                `;
                listItem.addEventListener('click', () => {
                    map.setView(location.coords, 14); // Zoom to location on click
                    // Optionally open the popup
                    const marker = allMarkers.find(m => m.locationId === location.id);
                    if (marker) {
                        marker.openPopup();
                    }
                });
                locationList.appendChild(listItem);
            });
        }

        // Filter button functions
        function showTouristSpots() {
            spiritualLayer.addTo(map);
            historicalLayer.addTo(map);
            transportLayer.remove();
            eventLayer.remove();
            hotelLayer.remove();
             updateButtonState('btn-tourist');
             updateLocationList('spiritual'); // Update list with spiritual locations
        }

        function showTransportation() {
            transportLayer.addTo(map);
            spiritualLayer.remove();
            historicalLayer.remove();
            eventLayer.remove();
            hotelLayer.remove();
            updateButtonState('btn-transport');
             updateLocationList('transport'); // Update list
        }

        function showHotels() {
             hotelLayer.addTo(map);
            spiritualLayer.remove();
            historicalLayer.remove();
            transportLayer.remove();
            eventLayer.remove();
            updateButtonState('btn-hotels');
             updateLocationList('hotel'); // Update list
        }

        function showEvents() {
             eventLayer.addTo(map);
            spiritualLayer.remove();
            historicalLayer.remove();
            transportLayer.remove();
            hotelLayer.remove();
            updateButtonState('btn-events');
             updateLocationList('event'); // Update list
        }

        function showAll() {
            spiritualLayer.addTo(map);
            historicalLayer.addTo(map);
            transportLayer.addTo(map);
            eventLayer.addTo(map);
            hotelLayer.addTo(map);
            updateButtonState('btn-all');
             updateLocationList('all'); // Update list with all locations
        }

        function updateButtonState(activeButtonId) {
            const buttons = document.querySelectorAll('.map-controls .map-btn');
            buttons.forEach(button => {
                if (button.id === activeButtonId) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }

         function zoomToLocation(lat, lng, zoom) {
            map.setView([lat, lng], zoom);
        }


        // Search functionality
        function searchLocation() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (!searchTerm) return;

            const foundLocation = allLocations.find(location =>
                location.name.toLowerCase().includes(searchTerm) ||
                location.description.toLowerCase().includes(searchTerm) ||
                location.category.toLowerCase().includes(searchTerm)
            );

            if (foundLocation) {
                map.setView(foundLocation.coords, 14); // Zoom to found location
                 const marker = allMarkers.find(m => m.locationId === foundLocation.id);
                  if (marker) {
                      marker.openPopup(); // Open popup for the found location
                  }
            } else {
                alert(`Location "${searchTerm}" not found in Bihar.`);
            }
        }


        // Fetch weather data (using a placeholder function)
        function fetchWeatherData() {
            // In a real application, you would fetch this from a weather API
            // For this demo, we use placeholder data
            const weatherInfoDiv = document.getElementById('weather-info');
             weatherInfoDiv.innerHTML = `
                <div class="weather-header">
                    <span class="weather-city">Patna</span>
                    <span class="weather-temp">34°C</span>
                </div>
                <div class="weather-details">
                    <div class="weather-detail">
                        <i class="fas fa-cloud"></i>
                        <p>Condition</p>
                        <p class="value">Partly Cloudy</p>
                    </div>
                    <div class="weather-detail">
                        <i class="fas fa-water"></i>
                        <p>Humidity</p>
                        <p class="value">60%</p>
                    </div>
                    <div class="weather-detail">
                        <i class="fas fa-wind"></i>
                        <p>Wind</p>
                        <p class="value">15 km/h</p>
                    </div>
                    <div class="weather-detail">
                         <i class="fas fa-temperature-high"></i>
                         <p>Feels Like</p>
                         <p class="value">38°C</p>
                    </div>
                </div>
            `;
        }

         // Initial load
        showTouristSpots(); // Show tourist spots by default
        fetchWeatherData(); // Load weather data
        updateLocationList('spiritual'); // Populate initial location list
    </script>
</body>
</html>